var VirtualJoystick = function (t) { t = t || {}, this._isBootstrap = t.isBootstrap || !1, this._container = t.container || document.body, this._strokeStyle = t.strokeStyle || "cyan", this._stickEl = t.stickElement || this._buildJoystickStick(), this._baseEl = t.baseElement || this._buildJoystickBase(), this._mouseSupport = void 0 !== t.mouseSupport && t.mouseSupport, this._stationaryBase = t.stationaryBase || !1, this._baseX = this._stickX = t.baseX || 0, this._baseY = this._stickY = t.baseY || 0, this._limitStickTravel = t.limitStickTravel || !1, this._stickRadius = void 0 !== t.stickRadius ? t.stickRadius : 100, this._useCssTransform = void 0 !== t.useCssTransform && t.useCssTransform, this._container.style.position = "relative", this._baseEl.style.display = "none", this._stickEl.style.display = "none", this._isBootstrap, this._baseEl.style.setProperty("position", "absolute", "important"), this._stickEl.style.setProperty("position", "absolute", "important"), this._container.appendChild(this._baseEl), this._container.appendChild(this._stickEl), this._pressed = !1, this._touchIdx = null, !0 === this._stationaryBase && (this._baseEl.style.display = "block !important", this._baseEl.style.left = this._baseX - this._baseEl.width / 2 + "px", this._baseEl.style.top = this._baseY - this._baseEl.height / 2 + "px"), this._transform = !!this._useCssTransform && this._getTransformProperty(), this._has3d = this._check3D(); var s = function (t, s) { return function () { return t.apply(s, arguments) } }; this._$onTouchStart = s(this._onTouchStart, this), this._$onTouchEnd = s(this._onTouchEnd, this), this._$onTouchMove = s(this._onTouchMove, this), this._container.addEventListener("touchstart", this._$onTouchStart, !1), this._container.addEventListener("touchend", this._$onTouchEnd, !1), this._container.addEventListener("touchmove", this._$onTouchMove, !1), this._mouseSupport && (this._$onMouseDown = s(this._onMouseDown, this), this._$onMouseUp = s(this._onMouseUp, this), this._$onMouseMove = s(this._onMouseMove, this), this._container.addEventListener("mousedown", this._$onMouseDown, !1), this._container.addEventListener("mouseup", this._$onMouseUp, !1), this._container.addEventListener("mousemove", this._$onMouseMove, !1)) }; VirtualJoystick.prototype.destroy = function () { this._container.removeChild(this._baseEl), this._container.removeChild(this._stickEl), this._container.removeEventListener("touchstart", this._$onTouchStart, !1), this._container.removeEventListener("touchend", this._$onTouchEnd, !1), this._container.removeEventListener("touchmove", this._$onTouchMove, !1), this._mouseSupport && (this._container.removeEventListener("mouseup", this._$onMouseUp, !1), this._container.removeEventListener("mousedown", this._$onMouseDown, !1), this._container.removeEventListener("mousemove", this._$onMouseMove, !1)) }, VirtualJoystick.touchScreenAvailable = function () { return "createTouch" in document }, function (t) { t.addEventListener = function (t, s) { return void 0 === this._events && (this._events = {}), this._events[t] = this._events[t] || [], this._events[t].push(s), s }, t.removeEventListener = function (t, s) { void 0 === this._events && (this._events = {}), t in this._events != !1 && this._events[t].splice(this._events[t].indexOf(s), 1) }, t.dispatchEvent = function (t) { if (void 0 === this._events && (this._events = {}), void 0 !== this._events[t]) for (var s = this._events[t].slice(), i = 0; i < s.length; i++) { var e = s[i].apply(this, Array.prototype.slice.call(arguments, 1)); if (void 0 !== e) return e } } }(VirtualJoystick.prototype), VirtualJoystick.prototype.deltaX = function () { return this._pressed ? this._stickX - this._baseX : 0 }, VirtualJoystick.prototype.deltaY = function () { return this._pressed ? this._stickY - this._baseY : 0 }, VirtualJoystick.prototype.up = function () { if (!1 === this._pressed) return !1; var t = this.deltaX(), s = this.deltaY(); return !(s >= 0) && !(Math.abs(t) > 2 * Math.abs(s)) }, VirtualJoystick.prototype.down = function () { if (!1 === this._pressed) return !1; var t = this.deltaX(), s = this.deltaY(); return !(s <= 0) && !(Math.abs(t) > 2 * Math.abs(s)) }, VirtualJoystick.prototype.right = function () { if (!1 === this._pressed) return !1; var t = this.deltaX(), s = this.deltaY(); return !(t <= 0) && !(Math.abs(s) > 2 * Math.abs(t)) }, VirtualJoystick.prototype.left = function () { if (!1 === this._pressed) return !1; var t = this.deltaX(), s = this.deltaY(); return !(t >= 0) && !(Math.abs(s) > 2 * Math.abs(t)) }, VirtualJoystick.prototype._onUp = function () { this._pressed = !1, this._stickEl.style.display = "none", 0 == this._stationaryBase && (this._baseEl.style.display = "none", this._baseX = this._baseY = 0, this._stickX = this._stickY = 0) }, VirtualJoystick.prototype._onDown = function (t, s) { if (this._pressed = !0, 0 == this._stationaryBase && (this._baseX = t, this._baseY = s, this._baseEl.style.display = "block", this._move(this._baseEl.style, this._baseX - this._baseEl.width / 2, this._baseY - this._baseEl.height / 2)), this._stickX = t, this._stickY = s, !0 === this._limitStickTravel) { var i = this.deltaX(), e = this.deltaY(), o = Math.sqrt(i * i + e * e); if (o > this._stickRadius) { var n = i / o, r = e / o; this._stickX = n * this._stickRadius + this._baseX, this._stickY = r * this._stickRadius + this._baseY } } this._stickEl.style.display = "", this._move(this._stickEl.style, this._stickX - this._stickEl.width / 2, this._stickY - this._stickEl.height / 2) }, VirtualJoystick.prototype._onMove = function (t, s) { if (!0 === this._pressed) { if (this._stickX = t, this._stickY = s, !0 === this._limitStickTravel) { var i = this.deltaX(), e = this.deltaY(), o = Math.sqrt(i * i + e * e); if (o > this._stickRadius) { var n = i / o, r = e / o; this._stickX = n * this._stickRadius + this._baseX, this._stickY = r * this._stickRadius + this._baseY } } this._move(this._stickEl.style, this._stickX - this._stickEl.width / 2, this._stickY - this._stickEl.height / 2) } }, VirtualJoystick.prototype._onMouseUp = function (t) { return this._onUp() }, VirtualJoystick.prototype._onMouseDown = function (t) { t.preventDefault(); var s = t.clientX, i = t.clientY; return this._onDown(s, i) }, VirtualJoystick.prototype._onMouseMove = function (t) { var s = t.clientX, i = t.clientY; return this._onMove(s, i) }, VirtualJoystick.prototype._onTouchStart = function (t) { if (null === this._touchIdx && !1 !== this.dispatchEvent("touchStartValidation", t)) { this.dispatchEvent("touchStart", t), t.preventDefault(); var s = t.changedTouches[0]; this._touchIdx = s.identifier; var i = s.pageX, e = s.pageY; return this._onDown(i, e) } }, VirtualJoystick.prototype._onTouchEnd = function (t) { if (null !== this._touchIdx) { this.dispatchEvent("touchEnd", t); for (var s = t.changedTouches, i = 0; i < s.length && s[i].identifier !== this._touchIdx; i++); if (i !== s.length) return this._touchIdx = null, t.preventDefault(), this._onUp() } }, VirtualJoystick.prototype._onTouchMove = function (t) { if (null !== this._touchIdx) { for (var s = t.changedTouches, i = 0; i < s.length && s[i].identifier !== this._touchIdx; i++); if (i !== s.length) { var e = s[i]; t.preventDefault(); var o = e.pageX, n = e.pageY; return this._onMove(o, n) } } }, VirtualJoystick.prototype._buildJoystickBase = function () { var t = document.createElement("canvas"); t.width = 126, t.height = 126, this._isBootstrap && (t.id = "_joystickBaseCanvas"); var s = t.getContext("2d"); return s.beginPath(), s.strokeStyle = this._strokeStyle, s.lineWidth = 6, s.arc(t.width / 2, t.width / 2, 40, 0, 2 * Math.PI, !0), s.stroke(), s.beginPath(), s.strokeStyle = this._strokeStyle, s.lineWidth = 2, s.arc(t.width / 2, t.width / 2, 60, 0, 2 * Math.PI, !0), s.stroke(), t }, VirtualJoystick.prototype._buildJoystickStick = function () { var t = document.createElement("canvas"); t.width = 86, t.height = 86, this._isBootstrap && (t.id = "_joystickStickCanvas"); var s = t.getContext("2d"); return s.beginPath(), s.strokeStyle = this._strokeStyle, s.lineWidth = 6, s.arc(t.width / 2, t.width / 2, 40, 0, 2 * Math.PI, !0), s.stroke(), t }, VirtualJoystick.prototype._move = function (t, s, i) { this._transform ? this._has3d ? t[this._transform] = "translate3d(" + s + "px," + i + "px, 0)" : t[this._transform] = "translate(" + s + "px," + i + "px)" : (t.left = s + "px", t.top = i + "px") }, VirtualJoystick.prototype._getTransformProperty = function () { for (var t, s = ["webkitTransform", "MozTransform", "msTransform", "OTransform", "transform"], i = document.createElement("p"), e = 0; e < s.length; e++)if (t = s[e], null != i.style[t]) return t }, VirtualJoystick.prototype._check3D = function () { var t = this._getTransformProperty(); if (!t || !window.getComputedStyle) return module.exports = !1; var s = document.createElement("div"); s.style[t] = "translate3d(1px,1px,1px)", document.body.insertBefore(s, null); var i = getComputedStyle(s).getPropertyValue({ webkitTransform: "-webkit-transform", OTransform: "-o-transform", msTransform: "-ms-transform", MozTransform: "-moz-transform", transform: "transform" }[t]); return document.body.removeChild(s), null != i && i.length && "none" != i };